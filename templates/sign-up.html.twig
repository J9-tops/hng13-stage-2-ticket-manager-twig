{% extends 'layouts/base.html.twig' %}

{% block title %}Sign Up - TicketFlow{% endblock %}

{% block content %}
<div class="auth page-container">
  <div class="page-content">
    <div class="form-wrapper">
      <div class="signin-card">
        <a href="/" class="logo-section">
          <div class="logo-icon">
              <path clip-rule="evenodd" d="M24 4H42V17.3333V30.6667H24V44H6V30.6667V17.3333H24V4Z" fill="currentColor" fill-rule="evenodd"></path>
            </svg>
          </div>
          <h2 class="logo-text">TicketFlow</h2>
        </a>

        <h1 class="page-title">Create Your Account</h1>

        <form id="signUpForm" class="form-section" novalidate>
          <label class="form-label">
            <span class="label-text">Email</span>
            <input class="form-input" type="email" name="email" placeholder="jim@abc.com" />
            <span class="error-text" id="emailError"></span>
          </label>

          <label class="form-label">
            <span class="label-text">Password</span>
            <div class="password-field">
              <input class="form-input" name="password" type="password" placeholder="Enter your password" />
              <button type="button" id="togglePassword" class="password-icon">üëÅÔ∏è</button>
            </div>
            <span class="error-text" id="passwordError"></span>
          </label>

          <button type="submit" class="signin-button">Sign Up</button>
        </form>

        <p class="footer-text">
          Already have an account?
          <a href="/sign-in" class="footer-link">Sign In</a>
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  if (localStorage.getItem("ticketapp_session")) {
    window.location.href = "/dashboard";
  }

  const form = document.getElementById("signUpForm");
  const emailInput = form.email;
  const passwordInput = form.password;
  const emailError = document.getElementById("emailError");
  const passwordError = document.getElementById("passwordError");
  const togglePassword = document.getElementById("togglePassword");

  togglePassword.addEventListener("click", () => {
    passwordInput.type = passwordInput.type === "password" ? "text" : "password";
  });

  const validateSignUp = (data) => {
    const errors = {};
    if (!data.email) {
      errors.email = "Email is required.";
    } else if (!/\S+@\S+\.\S+/.test(data.email)) {
      errors.email = "Enter a valid email address.";
    }

    if (!data.password) {
      errors.password = "Password is required.";
    } else if (data.password.length < 6) {
      errors.password = "Password must be at least 6 characters long.";
    }
    return errors;
  };

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const formData = {
      email: emailInput.value.trim(),
      password: passwordInput.value.trim(),
    };

    const errors = validateSignUp(formData);
    emailError.textContent = errors.email || "";
    passwordError.textContent = errors.password || "";

    if (Object.keys(errors).length > 0) return;

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const emailExists = users.some((u) => u.email === formData.email);

    if (emailExists) {
      emailError.textContent = "This email is already registered.";
      Toastify({
        text: "Email already exists",
        duration: 3000,
        gravity: "top",
        position: "right",
        style: { background: "red" },
      }).showToast();
      return;
    }

    users.push(formData);
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("ticketapp_session", JSON.stringify(formData));

    Toastify({
        text: "Signing up successful, Redirecting...",
        duration: 3000,
        gravity: "top",
        position: "right",
        style: { background: "green" },
      }).showToast();
    setTimeout(()=> {
      window.location.href = "/dashboard";
    }, 1000);
  });
</script>


{% endblock %}
