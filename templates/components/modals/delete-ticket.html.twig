<div class="modal-content delete-modal" onclick="event.stopPropagation()">
  <div class="delete-modal-content">
    <div class="delete-icon-wrapper">
      <span class="icon delete-icon">warning</span>
    </div>
    <h3>Delete Ticket?</h3>
    <p>
      Are you sure you want to delete this ticket? This action cannot be
      undone.
    </p>
  </div>

  <div class="delete-modal-footer">
    <button class="btn-secondary" onclick="closeModal()">Cancel</button>
    <button onclick="deleteTicket()" class="btn-delete">Delete</button>
  </div>
</div>

<script>
  function closeModal() {
    const overlay = document.querySelector(".modal-overlay");
    if (overlay) overlay.remove();
  }

  function deleteTicket() {
    try {
      console.log("Delete ticket function called");

      const ticketData = window.deleteTicketData;
      
      if (!ticketData || !ticketData.id) {
        console.error("No ticket data found");
        if (typeof Toastify !== 'undefined') {
          Toastify({
            text: "Unable to identify ticket to delete.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#f44336",
          }).showToast();
        }
        return;
      }

      const ticketId = ticketData.id;
      const JSONTickets = localStorage.getItem("tickets");
      const storedTickets = JSONTickets ? JSON.parse(JSONTickets) : [];

      console.log("Stored tickets:", storedTickets);
      console.log("Deleting ticket ID:", ticketId);

      const updatedTickets = storedTickets.filter(ticket => ticket.id !== ticketId);

      if (updatedTickets.length === storedTickets.length) {
        console.warn("Ticket not found in storage");
        if (typeof Toastify !== 'undefined') {
          Toastify({
            text: "Ticket not found. It may have already been deleted.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#f44336",
          }).showToast();
        }
        return;
      }

      localStorage.setItem("tickets", JSON.stringify(updatedTickets));

      console.log("Ticket deleted successfully");

      if (typeof Toastify !== 'undefined') {
        Toastify({
          text: "Ticket deleted successfully!",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#4CAF50",
        }).showToast();
      }

      setTimeout(() => {
        closeModal();
        window.location.reload();
      }, 1000);

    } catch (error) {
      console.error("Error deleting ticket:", error);
      if (typeof Toastify !== 'undefined') {
        Toastify({
          text: "Something went wrong while deleting the ticket.",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#f44336",
        }).showToast();
      }
    }
  }
</script>